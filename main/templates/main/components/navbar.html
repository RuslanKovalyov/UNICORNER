<script>
    function openNav() {
        const sidebar = document.getElementById("mySidebar");
        const closeButton = sidebar.querySelector('.closebtn'); // First focusable element inside sidebar
        const focusableElements = sidebar.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    
        // Open sidebar
        sidebar.style.width = "270px";
        sidebar.setAttribute("aria-hidden", "false");
        document.querySelector('.menu_btn button').setAttribute('aria-expanded', 'true');
    
        // Set `tabindex="-1"` for all focusable elements initially
        focusableElements.forEach((el) => el.setAttribute('tabindex', '-1'));
    
        // Wait for the user to press Tab before enabling focus
        document.addEventListener('keydown', enableFocusOnTab);
    }
    
    function enableFocusOnTab(event) {
        if (event.key === 'Tab') {
            const sidebar = document.getElementById("mySidebar");
            const focusableElements = sidebar.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    
            // Enable focus on all focusable elements inside the sidebar
            focusableElements.forEach((el) => el.setAttribute('tabindex', '0'));
    
            // Remove this listener after enabling focus
            document.removeEventListener('keydown', enableFocusOnTab);
        }
    }
    
    function closeNav() {
        const sidebar = document.getElementById("mySidebar");
        const focusableElements = sidebar.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const menuButton = document.querySelector('.menu_btn button');
    
        // Close sidebar
        sidebar.style.width = "0";
        sidebar.setAttribute("aria-hidden", "true");
        menuButton.setAttribute('aria-expanded', 'false');
    
        // Exclude sidebar elements from tab order
        focusableElements.forEach((el) => el.setAttribute('tabindex', '-1'));
    
        // Remove focus from the menu button
        menuButton.blur();
    }
    
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            closeNav();
        }
    });
    
    document.getElementById("mySidebar").addEventListener('click', (event) => {
        event.stopPropagation();
    });       
</script>

<nav class="navbar" id="navbar">

    <span class="menu_btn">
        <!--menu_btn-->
        <button onclick="openNav()" aria-expanded="false" aria-controls="mySidebar" tabindex="0">תפריט&#9776;</button>
    </span>

    <span class="pc_navbar">
        <!--home-->
        {% if request.path == "/" %}
            <a style="color:red" href="{% url 'home' %}" tabindex="0" aria-current="page">ראשי</a>
        {% else %}
            <a href="{% url 'home' %}" tabindex="0" aria-current="page">ראשי</a>
        {% endif %}
        
        <!--google reviews-->
        <a href="https://g.page/r/CVZlErJ4LstcEB0/review" target="_blank" tabindex="0" aria-label="Opens in a new tab">
            Google reviews<span class="sr-only">(opens in a new tab)</span>
        </a>
    </span>

    <span class="sidebar" id="mySidebar" aria-hidden="true" role="navigation">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" tabindex="0" aria-label="Close sidebar">&times;</a>

        <!--home-->
        {% if request.path == "/" %}
            <a style="color:red" href="{% url 'home' %}" tabindex="0" aria-current="page">ראשי</a>
        {% else %}
            <a href="{% url 'home' %}" tabindex="0" aria-current="page">ראשי</a>
        {% endif %}

        <!--google reviews-->
        <a href="https://g.page/r/CVZlErJ4LstcEB0/review" target="_blank" tabindex="0" aria-label="Opens in a new tab">
            Google reviews<span class="sr-only">(opens in a new tab)</span>
        </a>
    </span>

</nav>